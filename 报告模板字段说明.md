# 渗透测试报告模板字段说明

## 基本信息字段

| 模板字段 | 说明 | 示例值 |
|---------|------|--------|
| `{{title}}` | 报告标题 | XX公司渗透测试报告 |
| `{{testers}}` | 测试人员（逗号分隔） | 张三, 李四 |

## 测试目标表格

使用行循环策略，在表格行中使用 `[字段名]` 格式：

| 模板字段 | 说明 |
|---------|------|
| `{{targets_table}}` | 测试目标表格（行循环标记） |
| `[seq]` | 序号 |
| `[name]` | 目标名称 |
| `[url]` | 目标URL |

**表格示例：**
```
| 序号 | 名称 | URL |
|------|------|-----|
| {{targets_table}} | [seq] | [name] | [url] |
```

## 漏洞列表区块

使用区块循环语法 `{{?vulnerabilities}}...{{/vulnerabilities}}`

| 模板字段 | 说明 |
|---------|------|
| `{{?vulnerabilities}}` | 漏洞列表开始标记 |
| `{{/vulnerabilities}}` | 漏洞列表结束标记 |
| `{{seq}}` | 漏洞序号（从1开始） |
| `{{targetName}}` | 目标名称 ⚠️ **注意：使用驼峰命名** |
| `{{location}}` | 漏洞位置 |
| `{{vul_type}}` | 漏洞类型 |
| `{{risk_level}}` | 风险等级 |
| `{{url}}` | 漏洞URL |
| `{{process}}` | 漏洞过程/复现步骤 |
| `{{vul_description}}` | 漏洞描述 |
| `{{vul_advice}}` | 修复建议 |

**漏洞区块示例：**
```
{{?vulnerabilities}}
4.{{seq}} {{targetName}}{{location}}存在{{vul_type}}漏洞-{{risk_level}}

目标名称：{{targetName}}
漏洞URL：{{url}}
漏洞过程：{{process}}
漏洞描述：{{vul_description}}
修复建议：{{vul_advice}}
{{/vulnerabilities}}
```

## 总结字段

| 模板字段 | 说明 |
|---------|------|
| `{{overview}}` | 安全风险总结 |

## 重要说明

### 1. 字段命名规则
- **区块循环内字段**：建议使用驼峰命名（如 `targetName`），避免使用下划线
- 原因：POI-TL 使用 SpEL 表达式解析，下划线字段在某些情况下可能无法正确解析

### 2. 区块循环语法
- 开始标记：`{{?列表名}}`
- 结束标记：`{{/列表名}}`
- 区块内的字段直接使用 `{{字段名}}`

### 3. 表格行循环语法
- 在表格第一个数据行的第一个单元格放置 `{{表格变量名}}`
- 该行内的其他单元格使用 `[字段名]` 格式
- 系统会自动复制整行并填充数据

## 完整模板结构示例

```
项目名称：{{title}}
测试人员：{{testers}}

一、测试目标
| 序号 | 名称 | URL |
|------|------|-----|
| {{targets_table}} | [seq] | [name] | [url] |

四、问题归纳
{{?vulnerabilities}}
4.{{seq}} {{targetName}}{{location}}存在{{vul_type}}漏洞-{{risk_level}}

目标名称：{{targetName}}
漏洞URL：{{url}}
漏洞过程：{{process}}
漏洞描述：{{vul_description}}
修复建议：{{vul_advice}}
{{/vulnerabilities}}

五、安全风险总结
{{overview}}
```

## 后续扩展

如需添加新字段，请：
1. 在后端 `ProjectRoundReportBuildService.java` 的 `buildPentestReportData` 方法中添加数据
2. 在模板中添加对应的占位符
3. 区块循环内的字段需在 `vulnerabilityData` Map 中添加
